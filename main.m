%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%   SPATIALLY-WEIGHTED   %%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%          FACTOR          %%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%        ANALYSIS        %%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% Author: Saeid ESMAEILOGHLI
% February 26, 2019
% ------------------------
% Institut de Recherche en Astrophysique et Planétologie (IRAP) 
% Centre National de la Recherche Scientifique (CNRS),
% Observatoire Midi-Pyrénées (OMP),
% Université Paul Sabatier (UPS),
% 14 Avenue Edouard Belin,
% 31400 Toulouse,
% France.
% ------------------------
% Department of Mining Engineering,
% Isfahan University of Technology (IUT),
% University Boulevard, Esteghlal Square,
% 84156-83111 Isfahan,
% Iran.
% ------------------------
% Phone: (+33) 6 25 47 67 03
% E-mail: saeid@mail.fr
% ORCID: 0000-0002-7786-657X
% Website: http://esmaeiloghli.mining.iut.ac.ir
% GoogleScholar: http://scholar.google.com/citations?user=EZKZcwQAAAAJ&hl=en
% ResearchGate: https://www.researchgate.net/profile/Saeid_Esmaeiloghli
% ACADEMIA: https://cnrs.academia.edu/SaeidEsmaeiloghli

% -------------------------------------------------------------------------

% Author's statements:
%
% This is the main script that implements the spatially-weighted factor
% analysis based on the given (spatially-weighted) covariance (correlation)
% matrix.
%
% The program inputs the calculated spatially-weighted covariance
% (correlation) matrix. The same matrix must be inserted in the m-file
% "fabycovcor". The program returns the following outputs:
%
% Complete factor analysis results such as:
% - Table of primary extracted factors;
% - Table of unrotated principal components of the factor analysis;
% - Proportion of total (standardized) sample variance;
% - Table of cumulative proportion of total (standardized) sample variance;
% 
% as well as optional results such as:
% - Table of varimax rotated factor loadings;
% - Residual Matrix.
%
% To cite this file, this would be an appropriate format:
% Esmaeiloghli, S., Tabatabaei, S.H., Carranza, E.J.M., Hosseini, S.,
% Deville, Y. "Spatially-weighted factor analysis for extraction of
% source-oriented mineralization feature in 3D coordinates of surface
% geochemical signal." Journal of Geochemical Exploration (2020).


%% Input Covariance (Correlation) Matrix

clear all
close all
clc

X = [0.647885333342342 0.0426106510805856 -0.0873937739943854 -0.138437935303484 -0.0419272078395394 0.0659609286159014 0.0775548696503852 -0.135361398982353 -0.059996214058172 0.0965118419397806 -0.0619467714862916 -0.0807244864130452 0.0861764334541858 -0.0543895860632112 -0.134040137636823 -0.0545653158301922 -0.094033130051292 -0.0607529164211471 -0.0131311840032443
0.0426106510805855 0.747702430818829 -0.110392691046506 -0.406335397729601 -0.105822815029209 -0.150329320793043 0.013072183563985 -0.281437636233866 -0.192452653300457 0.332352119723311 -0.10220321830102 0.250006343326122 0.445646088032776 -0.0772657728064846 -0.122072869849677 0.0940545494905487 -0.084055367192167 -0.1120082112256 -0.181068412528526
-0.0873937739943855 -0.110392691046506 0.124968992378523 0.12498620126363 0.0832197060893665 -0.10452569780887 -0.260353345555927 0.0775966576653644 0.129759388929568 -0.0696408763959601 -0.0575805750179429 -0.0596958579026199 -0.110913339809071 0.0221461002287777 0.146218625132374 0.0337460367797833 0.0754009539905978 0.00425174921156333 0.0382017458617334
-0.138437935303484 -0.406335397729601 0.12498620126363 1.0046800009738 0.195301363459486 -0.0421883038408655 -0.824394394088547 0.616609669679743 0.429423991149868 -0.406705380530142 -0.111920932684325 -0.504370407120403 -0.376206124345471 -0.128450874942435 0.405651799797647 -0.339507166067696 0.177870862913355 -0.157509442367215 0.481502469782657
-0.0419272078395394 -0.105822815029209 0.0832197060893665 0.195301363459486 0.313764292961679 -0.20141764288175 -0.431957835197207 0.0603003926145698 0.162078113601137 -0.100200845973928 -0.0548250145881923 -0.106592967325025 -0.0619292997369236 -0.00734377358727508 0.149602625150299 0.00725942327126677 0.0900613145463319 -0.0262663131832175 0.0766964836481311
0.0659609286159014 -0.150329320793043 -0.10452569780887 -0.0421883038408653 -0.20141764288175 0.789061846821515 0.777055451098386 0.0247547063476239 -0.26220573681694 -0.191078298670772 0.147482937862553 -0.230748078372607 -0.0945779564403953 0.0261456283080671 -0.334306163256645 -0.0874436076755812 -0.149692762499605 0.0363282503063526 -0.0182761803033257
0.0775548696503852 0.013072183563985 -0.260353345555926 -0.824394394088547 -0.431957835197207 0.777055451098386 2.19094301544091 -0.451320936958441 -0.778599941078543 -0.0680229173669183 0.375298672836771 0.214831815774252 0.147133708563086 0.239544561004265 -0.864536768311916 0.143302782558153 -0.341843837002441 0.320874578043903 -0.478581662974156
-0.135361398982353 -0.281437636233866 0.0775966576653643 0.616609669679743 0.0603003926145698 0.0247547063476239 -0.451320936958441 0.530604832361098 0.238421339146838 -0.268736076106404 -0.0779618518915214 -0.346185665175254 -0.256149486732935 -0.0881681217936967 0.244500814528626 -0.211899578685928 0.11487411645046 -0.108618258819386 0.318176482585464
-0.059996214058172 -0.192452653300457 0.129759388929568 0.429423991149868 0.162078113601137 -0.26220573681694 -0.778599941078543 0.238421339146838 0.450705682130988 -0.0896707748715748 -0.132704206879797 -0.205194623015294 -0.214165217128719 -0.0694179058364463 0.40273647932525 -0.106833306490437 0.142588723978855 -0.0657827577840572 0.221309618997935
0.0965118419397806 0.332352119723311 -0.0696408763959601 -0.406705380530142 -0.100200845973928 -0.191078298670772 -0.0680229173669183 -0.268736076106404 -0.0896707748715748 0.720899928807234 -0.141662662632212 0.198999357458145 0.270557630591484 -0.111300805564285 -0.0212298252869235 0.128705307248799 -0.107790089787567 -0.0822421546713573 -0.0897454779107082
-0.0619467714862917 -0.10220321830102 -0.0575805750179428 -0.111920932684325 -0.0548250145881922 0.147482937862553 0.375298672836771 -0.0779618518915214 -0.132704206879797 -0.141662662632212 0.536496363239912 -0.0254332460558508 -0.0753649950661876 0.056043541002723 -0.171108821136312 -0.031388649346441 -0.018375632131069 0.0584866045501559 -0.111331542274953
-0.0807244864130452 0.250006343326123 -0.0596958579026199 -0.504370407120403 -0.106592967325025 -0.230748078372607 0.214831815774252 -0.346185665175254 -0.205194623015294 0.198999357458145 -0.0254332460558508 0.91944434937091 0.195748813612522 0.0343001705450448 -0.0888407309505298 0.149128071522192 -0.0334579389344381 0.0723141298162147 -0.353529050160336
0.0861764334541859 0.445646088032776 -0.110913339809071 -0.376206124345471 -0.0619292997369236 -0.0945779564403952 0.147133708563086 -0.256149486732935 -0.214165217128719 0.270557630591484 -0.0753649950661876 0.195748813612522 0.534936587778413 -0.0553533332737942 -0.178867854951491 0.0851767585802321 -0.11437794128792 -0.0622256637462125 -0.165244808093578
-0.0543895860632112 -0.0772657728064846 0.0221461002287777 -0.128450874942435 -0.00734377358727507 0.0261456283080671 0.239544561004265 -0.0881681217936967 -0.0694179058364463 -0.111300805564285 0.056043541002723 0.0343001705450449 -0.0553533332737943 0.183008422155104 -0.095944568625581 0.105897144105167 0.0291272267199413 0.120354748942689 -0.128932800518569
-0.134040137636823 -0.122072869849677 0.146218625132374 0.405651799797647 0.149602625150299 -0.334306163256646 -0.864536768311916 0.244500814528626 0.40273647932525 -0.0212298252869235 -0.171108821136312 -0.0888407309505298 -0.178867854951491 -0.095944568625581 0.516699470091096 -0.0911665516706229 0.167588898911617 -0.104165680747535 0.173281259487146
-0.0545653158301922 0.0940545494905487 0.0337460367797833 -0.339507166067696 0.00725942327126678 -0.0874436076755812 0.143302782558153 -0.211899578685928 -0.106833306490437 0.128705307248799 -0.031388649346441 0.149128071522192 0.0851767585802321 0.105897144105167 -0.0911665516706229 0.282622293660409 -0.0160244975722678 0.0716709264791952 -0.162734620356579
-0.094033130051292 -0.084055367192167 0.0754009539905978 0.177870862913355 0.0900613145463319 -0.149692762499605 -0.341843837002441 0.11487411645046 0.142588723978855 -0.107790089787567 -0.018375632131069 -0.0334579389344381 -0.11437794128792 0.0291272267199413 0.167588898911617 -0.0160244975722678 0.163642351798251 -0.0292503951166532 0.0277471422660099
-0.0607529164211471 -0.1120082112256 0.00425174921156333 -0.157509442367215 -0.0262663131832175 0.0363282503063526 0.320874578043903 -0.108618258819386 -0.0657827577840572 -0.0822421546713573 0.0584866045501559 0.0723141298162147 -0.0622256637462125 0.120354748942689 -0.104165680747535 0.0716709264791952 -0.0292503951166532 0.253695440553198 -0.12915463382089
-0.0131311840032442 -0.181068412528526 0.0382017458617335 0.481502469782657 0.0766964836481311 -0.0182761803033257 -0.478581662974156 0.318176482585464 0.221309618997934 -0.0897454779107082 -0.111331542274953 -0.353529050160335 -0.165244808093578 -0.128932800518569 0.173281259487146 -0.162734620356579 0.0277471422660099 -0.12915463382089 0.49481517031579
]

%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%        NOW        %%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%   YOU CAN RUN THE   %%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%      PROGRAM      %%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%% Factor Analysis

fabycovcor(X)
